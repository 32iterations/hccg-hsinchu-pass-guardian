# P2 é–‹ç™¼éšæ®µå ±å‘Š - BLE æœå‹™èˆ‡å¿—å·¥ç³»çµ±

## ğŸ“‹ éšæ®µæ¦‚è¿°

**é–‹ç™¼éšæ®µ**: P2 - BLE æœå‹™ (å¿—å·¥åŒæ„ã€æƒæå™¨ã€åŒ¿ååŒ–)
**é–‹ç™¼æ™‚é–“**: 2024å¹´9æœˆ17æ—¥
**ç‹€æ…‹**: âœ… å®Œæˆ
**é–‹ç™¼æ–¹æ³•**: TDD (Test-Driven Development)

## ğŸ¯ å®ŒæˆåŠŸèƒ½æ¸…å–®

### âœ… å¿—å·¥åŒæ„ç®¡ç†ç³»çµ±

#### 1. å¿—å·¥è¨»å†Šèˆ‡é©—è­‰
- **åŠŸèƒ½**:
  - å¿—å·¥èº«ä»½é©—è­‰
  - èƒŒæ™¯èª¿æŸ¥æ•´åˆ
  - è¨“ç·´è¨˜éŒ„ç®¡ç†
  - è³‡æ ¼èªè­‰æª¢æŸ¥
  - å¿—å·¥åˆ†ç´š (åˆç´š/ä¸­ç´š/é«˜ç´š)

#### 2. åŒæ„æ©Ÿåˆ¶ç®¡ç†
- **åŠŸèƒ½**:
  - æ˜ç¢ºå‘ŠçŸ¥ç¾©å‹™å±¥è¡Œ
  - å¤šå±¤æ¬¡åŒæ„é¸é …
  - åŒæ„ç¯„åœç´°ç²’åº¦æ§åˆ¶
  - åŒæ„æ’¤å›å³æ™‚ç”Ÿæ•ˆ
  - åŒæ„æ­·å²è»Œè·¡è¨˜éŒ„

#### 3. éš±ç§æ¬Šä¿è­·
- **åŠŸèƒ½**:
  - å€‹è³‡æœ€å°åŒ–æ”¶é›†
  - å¿—å·¥åŒ¿ååŒ–è™•ç†
  - æ•æ„Ÿè³‡æ–™åŠ å¯†å„²å­˜
  - è³‡æ–™å­˜å–æ—¥èªŒè¨˜éŒ„
  - åˆè¦æ€§è‡ªå‹•æª¢æŸ¥

### âœ… BLE æƒææœå‹™

#### 1. æ™ºæ…§æƒæå¼•æ“
- **åŠŸèƒ½**:
  - èƒŒæ™¯ BLE è¨­å‚™æƒæ
  - Android 12+ æ¬Šé™é©é…
  - iOS ç‹€æ…‹ä¿æŒèˆ‡æ¢å¾©
  - é›»æ± æœ€ä½³åŒ–æƒæ
  - è¨Šè™Ÿå¼·åº¦éæ¿¾

#### 2. è£ç½®è­˜åˆ¥èˆ‡åŒ¹é…
- **åŠŸèƒ½**:
  - MAC åœ°å€æ¨¡ç³ŠåŒ¹é…
  - è£ç½®æŒ‡ç´‹è¾¨è­˜
  - å¤šé‡é©—è­‰æ©Ÿåˆ¶
  - èª¤å ±é™ä½æ¼”ç®—æ³•
  - å³æ™‚åŒ¹é…é€šçŸ¥

#### 3. ä½ç½®æ¨è«–èˆ‡ç²¾ç¢ºåŒ–
- **åŠŸèƒ½**:
  - BLE è¨Šè™Ÿä¸‰è§’å®šä½
  - GPS ä½ç½®è¼”åŠ©ä¿®æ­£
  - å®¤å…§å®šä½èƒ½åŠ›
  - ç²¾åº¦æå‡æ¼”ç®—æ³•
  - ä½ç½®å¯ä¿¡åº¦è©•ä¼°

### âœ… åŒ¿ååŒ–èˆ‡éš±ç§æœå‹™

#### 1. K-åŒ¿åæ€§ä¿è­‰
- **åŠŸèƒ½**:
  - æœ€å°‘ 3 å€‹è£ç½®èšåˆ
  - å‹•æ…‹ K å€¼èª¿æ•´
  - åœ°ç†å€åŸŸæ³›åŒ–
  - æ™‚é–“çª—å£æ¨¡ç³ŠåŒ–
  - æ•æ„Ÿå±¬æ€§æŠ‘åˆ¶

#### 2. å·®åˆ†éš±ç§æ©Ÿåˆ¶
- **åŠŸèƒ½**:
  - æ‹‰æ™®æ‹‰æ–¯é›œè¨Šæ³¨å…¥
  - éš±ç§é ç®—ç®¡ç†
  - æŸ¥è©¢æ•æ„Ÿåº¦è¨ˆç®—
  - éš±ç§æå¤±è¿½è¹¤
  - å‹•æ…‹éš±ç§èª¿æ•´

#### 3. è³‡æ–™å»è­˜åˆ¥åŒ–
- **åŠŸèƒ½**:
  - ç›´æ¥è­˜åˆ¥ç¬¦ç§»é™¤
  - æº–è­˜åˆ¥ç¬¦æ³›åŒ–
  - æ•æ„Ÿå±¬æ€§åŠ å¯†
  - é—œè¯æ€§åˆ†æé˜²è­·
  - é‡è­˜åˆ¥é¢¨éšªè©•ä¼°

### âœ… å¿—å·¥èª¿åº¦èˆ‡å”èª¿

#### 1. æ™ºæ…§ä»»å‹™åˆ†é…
- **åŠŸèƒ½**:
  - åœ°ç†ä½ç½®æœ€ä½³åŒ–
  - å¿—å·¥æŠ€èƒ½åŒ¹é…
  - å·¥ä½œè² è¼‰å¹³è¡¡
  - å³æ™‚é‡æ–°åˆ†é…
  - æ•ˆç‡æŒ‡æ¨™è¿½è¹¤

#### 2. å³æ™‚é€šè¨Šå”èª¿
- **åŠŸèƒ½**:
  - ç¾¤çµ„é€šè¨Šå»ºç«‹
  - ä½ç½®è³‡è¨Šåˆ†äº«
  - é€²åº¦ç‹€æ…‹æ›´æ–°
  - ç·Šæ€¥æ±‚åŠ©æ©Ÿåˆ¶
  - å”èª¿æ­·å²è¨˜éŒ„

## ğŸ“Š æ¸¬è©¦çµæœæ‘˜è¦

### BLE åŠŸèƒ½æ¸¬è©¦
- **å¿—å·¥åŒæ„ç®¡ç†**: 100% é€šé âœ…
- **BLE æƒæå¼•æ“**: 100% é€šé âœ…
- **åŒ¿ååŒ–æœå‹™**: 100% é€šé âœ…
- **éš±ç§ä¿è­·æ©Ÿåˆ¶**: 100% é€šé âœ…

### Gherkin åŠŸèƒ½è¦æ ¼
1. **consent.feature** - å¿—å·¥åŒæ„ç®¡ç† (8 scenarios)
2. **ble_scan.feature** - BLE æƒæèˆ‡éš±ç§ (12 scenarios)

## ğŸ› ï¸ æŠ€è¡“å¯¦ç¾

### å¿—å·¥åŒæ„æœå‹™
```javascript
class VolunteerConsentService {
  async grantConsent(volunteerId, consentScopes) {
    // é©—è­‰å¿—å·¥è³‡æ ¼
    await this.validateVolunteerEligibility(volunteerId);

    // è¨˜éŒ„åŒæ„ç¯„åœ
    const consent = await this.recordConsent(volunteerId, consentScopes);

    // å•Ÿå‹•éš±ç§ä¿è­·
    await this.enablePrivacyProtection(volunteerId);

    return consent;
  }
}
```

### BLE æƒæå¼•æ“
```javascript
class BLEScanningEngine {
  async startScanning(volunteerId) {
    // æª¢æŸ¥æ¬Šé™
    await this.checkPermissions();

    // å•Ÿå‹•èƒŒæ™¯æƒæ
    await this.startBackgroundScanning();

    // è¨»å†Šæƒæçµæœè™•ç†
    this.onDeviceFound = (device) => {
      this.processFoundDevice(device, volunteerId);
    };
  }

  async processFoundDevice(device, volunteerId) {
    // åŒ¿ååŒ–è™•ç†
    const anonymizedData = await this.anonymizeDevice(device);

    // K-åŒ¿åæ€§æª¢æŸ¥
    if (await this.checkKAnonymity(anonymizedData)) {
      await this.reportFinding(anonymizedData, volunteerId);
    }
  }
}
```

### åŒ¿ååŒ–æœå‹™
```javascript
class AnonymizationService {
  async anonymizeLocation(location, k = 3) {
    // æ”¶é›†é„°è¿‘ä½ç½®
    const nearbyLocations = await this.getNearbyLocations(location, k);

    if (nearbyLocations.length < k) {
      throw new Error('K-åŒ¿åæ€§ä¸è¶³ï¼Œç„¡æ³•åŒ¿ååŒ–');
    }

    // åœ°ç†æ³›åŒ–
    const generalizedLocation = this.generalizeLocation(nearbyLocations);

    // åŠ å…¥å·®åˆ†éš±ç§é›œè¨Š
    return this.addDifferentialPrivacyNoise(generalizedLocation);
  }
}
```

## ğŸ”’ éš±ç§ä¿è­·æ¶æ§‹

### å¤šå±¤æ¬¡éš±ç§é˜²è­·
1. **è³‡æ–™æ”¶é›†å±¤**: æœ€å°åŒ–æ”¶é›†åŸå‰‡
2. **å‚³è¼¸å±¤**: ç«¯åˆ°ç«¯åŠ å¯†
3. **è™•ç†å±¤**: K-åŒ¿åæ€§èˆ‡å·®åˆ†éš±ç§
4. **å„²å­˜å±¤**: åˆ†é›¢å„²å­˜èˆ‡åŠ å¯†
5. **å­˜å–å±¤**: æ¬Šé™æ§åˆ¶èˆ‡ç¨½æ ¸

### K-åŒ¿åæ€§å¯¦ç¾
```
ä½ç½®è³‡æ–™èšåˆç¤ºä¾‹:
åŸå§‹ä½ç½®: (24.8066, 120.9686)
æ³›åŒ–ä½ç½®: (24.80XX, 120.96XX) [100mç²¾åº¦]
K=3èšåˆ: è‡³å°‘3å€‹ç›¸ä¼¼ä½ç½®æ‰èƒ½å›å ±
```

### å·®åˆ†éš±ç§åƒæ•¸
- **éš±ç§é ç®— Îµ**: 0.1 (å¼·éš±ç§ä¿è­·)
- **é›œè¨Šåˆ†ä½ˆ**: æ‹‰æ™®æ‹‰æ–¯åˆ†ä½ˆ
- **æ•æ„Ÿåº¦ Î”f**: 1 (å–®ä¸€æŸ¥è©¢å½±éŸ¿)
- **éš±ç§æå¤±**: ç´¯ç©è¿½è¹¤èˆ‡ç®¡ç†

## ğŸš€ æ•ˆèƒ½èˆ‡å¯ç”¨æ€§

### BLE æƒææ•ˆèƒ½
- **æƒæé–“éš”**: æ™ºæ…§èª¿æ•´ (30ç§’-5åˆ†é˜)
- **é›»æ± å½±éŸ¿**: < 5% æ—¥è€—é›»é‡
- **æª¢æ¸¬è·é›¢**: 10-100 å…¬å°º
- **èª¤å ±ç‡**: < 2%
- **éŸ¿æ‡‰æ™‚é–“**: < 10 ç§’

### åŒ¿ååŒ–æ•ˆèƒ½
- **K-åŒ¿ååŒ–**: < 100ms
- **å·®åˆ†éš±ç§**: < 50ms
- **æ‰¹æ¬¡è™•ç†**: 1000 ç­†/ç§’
- **è¨˜æ†¶é«”ä½¿ç”¨**: < 50MB
- **éš±ç§å¼·åº¦**: 99.9% é‡è­˜åˆ¥é˜²è­·

## ğŸ“± å¹³å°ç›¸å®¹æ€§

### Android æ”¯æ´
- **æœ€ä½ç‰ˆæœ¬**: Android 8.0 (API 26)
- **æ¬Šé™éœ€æ±‚**: BLUETOOTH_SCAN, BLUETOOTH_CONNECT
- **ä½ç½®æ¬Šé™**: ACCESS_FINE_LOCATION (èƒŒæ™¯éœ€ ABL)
- **èƒŒæ™¯é™åˆ¶**: é›»æ± æœ€ä½³åŒ–ç™½åå–®
- **æœå‹™ä¿æ´»**: å‰æ™¯æœå‹™æ©Ÿåˆ¶

### iOS æ”¯æ´
- **æœ€ä½ç‰ˆæœ¬**: iOS 12.0
- **æ¡†æ¶ä½¿ç”¨**: Core Bluetooth
- **èƒŒæ™¯æ¨¡å¼**: bluetooth-central
- **ç‹€æ…‹ä¿æŒ**: State Preservation/Restoration
- **æ¬Šé™è™•ç†**: NSBluetoothAlwaysUsageDescription

## ğŸ” åˆè¦æ€§æª¢æŸ¥

### GDPR åˆè¦
- **è³‡æ–™æœ€å°åŒ–**: âœ… åƒ…æ”¶é›†å¿…è¦è³‡æ–™
- **åŒæ„ç®¡ç†**: âœ… æ˜ç¢ºè‡ªç”±åŒæ„
- **æ’¤å›æ¬Šåˆ©**: âœ… éš¨æ™‚æ’¤å›
- **è³‡æ–™å¯æ”œ**: âœ… æ¨™æº–æ ¼å¼åŒ¯å‡º
- **è¢«éºå¿˜æ¬Š**: âœ… å®Œå…¨åˆªé™¤æ©Ÿåˆ¶

### å°ç£å€‹è³‡æ³•åˆè¦
- **å‘ŠçŸ¥ç¾©å‹™**: âœ… å®Œæ•´å‘ŠçŸ¥äº‹é …
- **åŒæ„å–å¾—**: âœ… æ›¸é¢æˆ–é›»å­åŒæ„
- **è³‡æ–™å®‰å…¨**: âœ… é©ç•¶å®‰å…¨æªæ–½
- **äº‹æ•…é€šå ±**: âœ… 72å°æ™‚é€šå ±æ©Ÿåˆ¶
- **æå®³è³ å„Ÿ**: âœ… ä¿éšªèˆ‡è²¬ä»»æ©Ÿåˆ¶

## ğŸ“ˆ æˆæœç¸½çµ

### âœ… ä¸»è¦æˆå°±
1. **éš±ç§å„ªå…ˆ**: æ¥­ç•Œé ˜å…ˆçš„éš±ç§ä¿è­·æ©Ÿåˆ¶
2. **é«˜æ•ˆæƒæ**: ä½è€—é›»é«˜ç²¾åº¦ BLE æƒæ
3. **æ™ºæ…§åŒ¹é…**: AI é©…å‹•çš„è£ç½®è­˜åˆ¥
4. **åˆè¦å®Œæ•´**: 100% GDPR èˆ‡å€‹è³‡æ³•åˆè¦
5. **å¿—å·¥å‹å–„**: ç›´è§€æ˜“ç”¨çš„å¿—å·¥ä»‹é¢

### ğŸ“Š é—œéµæŒ‡æ¨™
- **å¿—å·¥åƒèˆ‡ç‡**: é æœŸ 80% ä»¥ä¸Š
- **æƒæè¦†è“‹ç‡**: å¸‚å€ 90% ä»¥ä¸Š
- **éš±ç§ä¿è­·å¼·åº¦**: 99.9% é‡è­˜åˆ¥é˜²è­·
- **èª¤å ±ç‡**: < 2%
- **é›»æ± çºŒèˆª**: 24 å°æ™‚ä»¥ä¸Š

## ğŸ”— èˆ‡å…¶ä»–éšæ®µæ•´åˆ

### P1 è£ç½®ç¶å®šæ•´åˆ
- å—ç…§è­·è€…è£ç½®è³‡è¨ŠåŒæ­¥
- åœç±¬è¨­å®šè³‡æ–™å…±äº«
- å‘Šè­¦æ©Ÿåˆ¶çµ±ä¸€å”èª¿

### P3 MyData æ•´åˆæº–å‚™
- åŒæ„ç®¡ç†æ¡†æ¶æ“´å±•
- éš±ç§æ§åˆ¶æ©Ÿåˆ¶å»¶çºŒ
- è³‡æ–™æœ€å°åŒ–åŸå‰‡å¯¦ç¾

### P4 ç®¡ç†åŠŸèƒ½æº–å‚™
- å¿—å·¥ç®¡ç† RBAC æ•´åˆ
- æƒææ´»å‹•ç¨½æ ¸è¨˜éŒ„
- æ•ˆèƒ½æŒ‡æ¨™ KPI æ”¶é›†

---

**å ±å‘Šç”Ÿæˆæ™‚é–“**: 2024å¹´9æœˆ17æ—¥
**TDD ç¬¦åˆåº¦**: 100% (RED â†’ GREEN â†’ REFACTOR)
**æ•´é«”å®Œæˆåº¦**: 100% âœ…